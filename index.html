<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NoiseGone — Онлайн очистка шума</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
  <style>
    /* CSS-стили для оформления */
    :root {
      --primary-color: #6c63ff;
      --text-color: #333;
      --bg-color: #f4f4f9;
      --dropzone-bg: #fff;
      --dropzone-border: #ccc;
      --dropzone-hover: #e6e6fa;
      --progress-bg: #e0e0e0;
      --progress-bar: var(--primary-color);
      --btn-bg: var(--primary-color);
      --btn-text: #fff;
      --danger-color: #f44336;
    }
    body {
      font-family: 'Inter', sans-serif;
      margin: 0;
      padding: 0;
      background-color: var(--bg-color);
      color: var(--text-color);
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      box-sizing: border-box;
    }
    .site-header {
      width: 100%;
      background-color: #fff;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      padding: 16px 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .brand {
      height: 40px;
    }
    .container {
      max-width: 600px;
      width: 100%;
      padding: 24px;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 16px;
      flex-grow: 1;
      justify-content: center;
    }
    h1 {
      position: absolute;
      left: -9999px;
      top: auto;
      width: 1px;
      height: 1px;
      overflow: hidden;
    }
    .sub {
      font-size: 1.25rem;
      font-weight: 600;
      color: #555;
    }
    .dropzone {
      width: 100%;
      height: 200px;
      border: 2px dashed var(--dropzone-border);
      border-radius: 12px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      transition: background-color 0.3s ease;
      background-color: var(--dropzone-bg);
    }
    .dropzone.hover {
      background-color: var(--dropzone-hover);
      border-color: var(--primary-color);
    }
    #hint {
      font-size: 1rem;
      font-weight: 600;
      margin: 0;
    }
    .formats {
      font-size: 0.875rem;
      color: #999;
      margin: 4px 0 0;
    }
    .fileInfo {
      font-weight: 600;
      margin: 0;
      min-height: 1em;
    }
    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.3s ease, transform 0.1s ease;
      font-size: 1rem;
    }
    #cleanBtn {
      background-color: var(--btn-bg);
      color: var(--btn-text);
    }
    #cleanBtn:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }
    #downloadBtn {
      background-color: var(--primary-color);
      color: #fff;
    }
    #newBtn {
      background-color: #f0f0f0;
      color: #555;
    }
    .progress {
      width: 100%;
      height: 24px;
      background-color: var(--progress-bg);
      border-radius: 12px;
      overflow: hidden;
      margin-top: 16px;
    }
    #progressBar {
      height: 100%;
      width: 0%;
      background-color: var(--progress-bar);
      transition: width 0.3s ease;
    }
    #result {
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 16px;
    }
    #messageBox {
      min-height: 20px;
      font-weight: 600;
      text-align: center;
      color: var(--danger-color);
    }
    .audio-controls {
      display: flex;
      gap: 16px;
      margin-top: 20px;
      justify-content: center;
      flex-wrap: wrap;
    }
    .audio-player-container {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .spinner {
      border: 4px solid rgba(0, 0, 0, 0.1);
      width: 36px;
      height: 36px;
      border-radius: 50%;
      border-left-color: var(--primary-color);
      animation: spin 1s ease infinite;
      margin-top: 16px;
    }
    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }
      100% {
        transform: rotate(360deg);
      }
    }
  </style>
</head>
<body>
  <!-- HEADER с логотипом -->
  <header class="site-header">
    <a href="/" class="brand" aria-label="NoiseGone">
      <!-- Использование placeholder-изображения для простоты, можно заменить на реальное -->
      <img src="https://placehold.co/120x40/6c63ff/ffffff?text=NoiseGone" alt="NoiseGone logo" height="40" />
    </a>
  </header>

  <!-- MAIN SECTION -->
  <main class="container">
    <!-- h1 визуально скрыт, но доступен для поисковиков и скрин-ридеров -->
    <h1>NoiseGone</h1>
    <p class="sub" data-i18n="subtitle"></p>

    <!-- Dropzone для загрузки файлов -->
    <div id="dropzone" class="dropzone" tabindex="0" aria-describedby="hint">
      <p id="hint" data-i18n="dropMessage"></p>
      <p class="formats" data-i18n="dropFormats"></p>
      <input type="file" id="fileInput" accept=".wav,.mp3,.m4a" hidden />
    </div>
    <p id="fileInfo" class="fileInfo"></p>

    <!-- Сообщение об ошибке или успехе -->
    <div id="messageBox"></div>

    <!-- Кнопка для запуска очистки -->
    <button id="cleanBtn" class="btn" disabled data-i18n="btnClean"></button>

    <!-- Спиннер загрузки, который будет виден во время обработки -->
    <div id="loadingSpinner" class="spinner" hidden></div>

    <!-- Индикатор прогресса -->
    <div id="progressWrap" class="progress" hidden>
      <div id="progressBar"></div>
    </div>

    <!-- Раздел с результатом -->
    <div id="result" hidden>
      <p data-i18n="done"></p>
      <div class="audio-controls">
        <div class="audio-player-container">
          <p data-i18n="originalFile"></p>
          <audio id="originalAudio" controls></audio>
        </div>
        <div class="audio-player-container">
          <p data-i18n="cleanedFile"></p>
          <audio id="cleanedAudio" controls></audio>
        </div>
      </div>
      <button id="downloadBtn" class="btn" data-i18n="btnDownload"></button>
      <button id="newBtn" class="btn" data-i18n="btnNew"></button>
    </div>
  </main>

  <!-- JAVASCRIPT -->
  <script>
    // Объект для интернационализации (I18n)
    const i18n = {
      en: {
        subtitle: 'Online noise remover',
        dropMessage: 'Drag & drop or choose file',
        dropFormats: 'WAV, MP3, M4A up to 50 MB',
        btnClean: 'Clean noise',
        done: 'Done.',
        originalFile: 'Original file',
        cleanedFile: 'Cleaned file',
        btnDownload: 'Download',
        btnNew: 'New file',
        sizeError: 'File is too large (>50 MB)',
        typeError: 'File type not supported'
      },
      ru: {
        subtitle: 'Онлайн очистка шума',
        dropMessage: 'Перетащите файл сюда или выберите',
        dropFormats: 'WAV, MP3, M4A до 50 МБ',
        btnClean: 'Очистить шум',
        done: 'Готово.',
        originalFile: 'Оригинальный файл',
        cleanedFile: 'Очищенный файл',
        btnDownload: 'Скачать',
        btnNew: 'Новый файл',
        sizeError: 'Файл слишком большой (>50 МБ)',
        typeError: 'Неподдерживаемый формат файла'
      }
    };

    // Определение языка браузера
    const lang = navigator.language.startsWith('ru') ? 'ru' : 'en';

    /* ===== DOM-элементы ===== */
    const dz = document.getElementById('dropzone');
    const fileInput = document.getElementById('fileInput');
    const fileInfo = document.getElementById('fileInfo');
    const cleanBtn = document.getElementById('cleanBtn');
    const progressWrap = document.getElementById('progressWrap');
    const progressBar = document.getElementById('progressBar');
    const result = document.getElementById('result');
    const downloadBtn = document.getElementById('downloadBtn');
    const newBtn = document.getElementById('newBtn');
    const messageBox = document.getElementById('messageBox');
    const originalAudio = document.getElementById('originalAudio');
    const cleanedAudio = document.getElementById('cleanedAudio');
    const loadingSpinner = document.getElementById('loadingSpinner');

    /* ===== Состояние приложения ===== */
    let selectedFile = null;
    let cleanedFileBlob = null;

    /* ===== Вспомогательные функции ===== */
    // Функция для перевода текста по ключу
    function t(key) { 
      return i18n[lang][key] || key;
    }

    // Функция для установки текстов на основе атрибута data-i18n
    function setTexts() {
      document.querySelectorAll('[data-i18n]')
        .forEach(el => el.textContent = t(el.dataset.i18n));
    }

    // Функция для отображения сообщений (вместо alert)
    function displayMessage(msg, type = 'error') {
      messageBox.textContent = msg;
      messageBox.style.color = type === 'error' ? 'var(--danger-color)' : 'var(--primary-color)';
    }

    // Функция для очистки сообщений
    function clearMessage() {
      messageBox.textContent = '';
    }

    /* ===== Обработка событий dropzone ===== */
    function handleFiles(list) {
      clearMessage();
      if (!list || !list[0]) return;
      const f = list[0];

      // Проверка на размер и тип файла
      if (f.size > 50 * 1024 * 1024) {
        displayMessage(t('sizeError'));
        return;
      }
      if (!/\.(wav|mp3|m4a)$/i.test(f.name)) {
        displayMessage(t('typeError'));
        return;
      }

      selectedFile = f;
      fileInfo.textContent = f.name;
      cleanBtn.disabled = false;
      originalAudio.src = URL.createObjectURL(selectedFile);
    }

    dz.addEventListener('click', () => fileInput.click());
    fileInput.addEventListener('change', e => handleFiles(e.target.files));

    ['dragenter', 'dragover'].forEach(ev =>
      dz.addEventListener(ev, e => {
        e.preventDefault();
        dz.classList.add('hover');
        e.dataTransfer.dropEffect = 'copy';
      })
    );

    ['dragleave', 'dragend', 'drop'].forEach(ev =>
      dz.addEventListener(ev, () => dz.classList.remove('hover'))
    );

    dz.addEventListener('drop', e => {
      e.preventDefault();
      handleFiles(e.dataTransfer.files);
    });

    /* Предотвращение открытия файлов в браузере по умолчанию */
    ['dragover', 'drop'].forEach(ev =>
      document.addEventListener(ev, e => {
        if (e.target !== dz) e.preventDefault();
      })
    );

    /* ===== Моделирование процесса очистки ===== */
    cleanBtn.addEventListener('click', () => {
      if (!selectedFile) return;
      
      // Скрытие/отображение элементов UI
      cleanBtn.disabled = true;
      loadingSpinner.hidden = false;
      progressWrap.hidden = false;
      result.hidden = true;

      // Моделирование прогресса
      let prog = 0;
      const progressInterval = setInterval(() => {
        prog += 0.1;
        if (prog > 1) {
            prog = 1;
        }
        progressBar.style.width = Math.round(prog * 100) + '%';
        if (prog === 1) {
          clearInterval(progressInterval);
          finish();
        }
      }, 300);
    });

    // Функция, вызываемая по завершении обработки
    function finish() {
      loadingSpinner.hidden = true;
      progressWrap.hidden = true;
      result.hidden = false;
      downloadBtn.disabled = false;
      
      // Имитация создания "очищенного" файла
      cleanedFileBlob = new Blob(['Mock cleaned audio data'], { type: 'audio/wav' });
      cleanedAudio.src = URL.createObjectURL(cleanedFileBlob);
    }

    /* ===== Обработка кнопок результата ===== */
    downloadBtn.addEventListener('click', () => {
      if (!cleanedFileBlob) return;
      const ext = selectedFile.name.split('.').pop();
      const base = selectedFile.name.replace(/\.[^/.]+$/, '');
      const a = document.createElement('a');
      a.href = URL.createObjectURL(cleanedFileBlob);
      a.download = `${base}.cleaned.${ext}`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(a.href);
    });

    newBtn.addEventListener('click', () => {
      // Сброс состояния приложения
      selectedFile = null;
      cleanedFileBlob = null;
      fileInfo.textContent = '';
      cleanBtn.disabled = true;
      result.hidden = true;
      progressWrap.hidden = true;
      progressBar.style.width = '0%';
      clearMessage();
      originalAudio.removeAttribute('src');
      cleanedAudio.removeAttribute('src');
    });

    /* ===== Инициализация ===== */
    window.onload = setTexts;
  </script>
</body>
</html>
